<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Pongo by ChenReason</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/main.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>

      <header>
        <h1>Pongo</h1>
        <p></p>
      </header>

      <div id="banner">
        <span id="logo"></span>

        </div>
      </div><!-- end banner -->

    <div class="wrapper">
      <nav>
        <ul></ul>
      </nav>
      <section>
       <canvas id="pane" width="400" height="400" style="background:rgb(240,222,185)" onTouchStart="changelinedirection()">
很抱歉，您的浏览器不支持我的游戏哦~
</canvas>
<input type="button" id="startgame" onTouchStart="startgame()"/>
<script language="javascript">

var gamespeed=0.8;//小球速度
var linespeed=Math.PI/100;
var crashdistance=15;
var gamedirection={
	shang	: 1,
	xia		: 5,
	zuo		: 7,
	you		: 3,
	zuoshang: 8,
	zuoxia	: 6,
	youshang: 2,
	youxia	: 4,
	clock	: 0,
	anticlock: 9,
	};//方向

var canvas={
	width : 400,
	height: 400,
	};//画布
	
var bigcircle = {//大圆参数
        x : 0,    //圆心的x轴坐标值
        y : 0,    //圆心的y轴坐标值
        r : 180,  //圆的半径
		c : 'rgb(255,255,255)',   
    };//大圆

var smallcircle = {//小圆参数
        x : 0,    //圆心的x轴坐标值
        y : 0,    //圆心的y轴坐标值
        r : 14,  //圆的半径
		c : 'rgb(204,105,106)',
		direction :  gamedirection.xia,
    };//小圆
	
var line = {//挡板线的参数
	x : 0,    //圆心的x轴坐标值
    y : 0,    //圆心的y轴坐标值
    r : 180 ,  //圆弧的半径
 start:(Math.PI/2-Math.PI/32),
  end :	(Math.PI/2+Math.PI/32),
	c : 'rgb(55,55,55)',
	direction: gamedirection.anticlock,
	};//跟踪线

var dot = {//跟踪点参数
	x	:	(bigcircle.r*Math.cos(line.start+Math.PI/16)),//以大圆为原点
	y	:	(bigcircle.r*Math.sin(line.start+Math.PI/16)),
	r	:	1,
	}//跟踪点
/*
var dot1 = {//跟踪点参数
	x	:	(bigcircle.r*Math.cos(line.start+Math.PI/16)),//以大圆为原点
	y	:	(bigcircle.r*Math.sin(line.start+Math.PI/16)),
	r	:	1,
	}//跟踪点	
var dot2 = {//跟踪点参数
	x	:	(bigcircle.r*Math.cos(line.start+Math.PI/16)),//以大圆为原点
	y	:	(bigcircle.r*Math.sin(line.start+Math.PI/16)),
	r	:	1,
	}//跟踪点	
*/
	
function changelinedirection()
{
	if(line.direction==gamedirection.clock)
	{
		line.direction=gamedirection.anticlock;
	}
	else
	{
		line.direction=gamedirection.clock;
	}
}
var objpane=document.getElementById("pane");
var ctxpane=objpane.getContext("2d");
ctxpane.translate(200,200);//必备 画布中心点平移

	
function getdistance(){
	var distance=(smallcircle.x - bigcircle.x)*(smallcircle.x - bigcircle.x)+(smallcircle.y - bigcircle.y)*(smallcircle.y - bigcircle.y);
	return distance;
	}//返回小球与大圆中心距离平方 getdistance()
	
function getangle(){
	var absy=Math.abs(line.y - bigcircle.y);
	var absx=Math.abs(line.x - bigcircle.x);
	var tanangle=absy/absx;
	}	//getangle()

function ifgameover(){//判断是否出界
	if((getdistance() - bigcircle.r*bigcircle.r)>2)
	return true;
	else
	return false;
	}	//判断游戏是否结束 ifgameover()

function ifcrash(){		//碰撞检测
	var dx = dot.x-smallcircle.x;
	var dy = dot.y-smallcircle.y;
	var dd=dx*dx+dy*dy;
	if(dd< crashdistance* crashdistance)
		return true;
	else 
		return false;
	}//碰撞检测 ifcrash()
	
function randomback()
{
	var x=Math.floor(Math.random()*3);
	switch (smallcircle.direction){				//根据小球方向做移动
				case gamedirection.shang:
				{
					switch (x)
					{
						case 0:
						smallcircle.direction=gamedirection.xia;
						break;
						case 1:
						smallcircle.direction=gamedirection.zuoxia;
						break;
						case 2:
						smallcircle.direction=gamedirection.youxia;
						break;
						default:
						break;
					}
				}
				case gamedirection.xia:
				{
					switch (x)
					{
						case 0:
						smallcircle.direction=gamedirection.shang;
						break;
						case 1:
						smallcircle.direction=gamedirection.zuoshang;
						break;
						case 2:
						smallcircle.direction=gamedirection.youshang;
						break;
						default:
						break;					
					}
				}
			    case gamedirection.zuo:
				{
					switch (x)
					{
						case 0:
						smallcircle.direction=gamedirection.you;
						break;
						case 1:
						smallcircle.direction=gamedirection.youshang;
						break;
						case 2:
						smallcircle.direction=gamedirection.youxia;
						break;
						default:
						break;
					}
				}
				case gamedirection.you:
				{
					switch (x)
					{
						case 0:
						smallcircle.direction=gamedirection.zuo;
						break;
						case 1:
						smallcircle.direction=gamedirection.zuoxia;
						break;
						case 2:
						smallcircle.direction=gamedirection.zuoshang;
						break;
						default:
						break;
					}
					
				}
				case gamedirection.zuoshang:
				{
					switch (x)
					{
						case 0:
						smallcircle.direction=gamedirection.youxia;
						break;
						case 1:
						smallcircle.direction=gamedirection.xia;
						break;
						case 2:
						smallcircle.direction=gamedirection.you;
						break;
						default:
						break;
					}
					
				}
				case gamedirection.zuoxia:
				{
					switch (x)
					{
						case 0:
						smallcircle.direction=gamedirection.youshang;
						break;
						case 1:
						smallcircle.direction=gamedirection.shang;
						break;
						case 2:
						smallcircle.direction=gamedirection.you;
						break;
						default:
						break;
					}
					
				}
				case gamedirection.youshang:
				{
					switch (x)
					{
						case 0:
						smallcircle.direction=gamedirection.zuoxia;
						break;
						case 1:
						smallcircle.direction=gamedirection.zuo;
						break;
						case 2:
						smallcircle.direction=gamedirection.xia;
						break;
						default:
						break;
					}
					
				}
				case gamedirection.youxia:
				{
					switch (x)
					{
						case 0:
						smallcircle.direction=gamedirection.zuoshang;
						break;
						case 1:
						smallcircle.direction=gamedirection.zuo;
						break;
						case 2:
						smallcircle.direction=gamedirection.youshang;
						break;
						default:
						break;
					}
					
				}
				default:
				{
					break;		
				}
			}	
}//小球随机反向 randomback()

function smallcircledirection()
{
	switch (smallcircle.direction){				//根据小球方向做移动
				case gamedirection.shang:
				{
					smallcircle.y=smallcircle.y-gamespeed;
					break;
				}
				case gamedirection.xia:
				{
					smallcircle.y=smallcircle.y+gamespeed;
					break;
				}
				case gamedirection.zuo:
				{
					smallcircle.x=smallcircle.x-gamespeed;
					break;
				}
				case gamedirection.you:
				{
					smallcircle.x=smallcircle.x+gamespeed;
					break;
				}
				case gamedirection.zuoshang:
				{
					smallcircle.x=smallcircle.x-gamespeed;
					smallcircle.y=smallcircle.y-gamespeed;
					break;
				}
				case gamedirection.zuoxia:
				{
					smallcircle.x=smallcircle.x-gamespeed;
					smallcircle.y=smallcircle.y+gamespeed;
					break;
				}
				case gamedirection.youshang:
				{
					smallcircle.x=smallcircle.x+gamespeed;
					smallcircle.y=smallcircle.y-gamespeed;
					break;
				}
				case gamedirection.youxia:
				{
					smallcircle.x=smallcircle.x+gamespeed;
					smallcircle.y=smallcircle.y+gamespeed;
					break;
				}
				default:
				{
					break;		
				}
			}	
}//小球移动 smallcircledirection()

/*画出底部圆*/
ctxpane.beginPath();	//大圆
ctxpane.arc(bigcircle.x,bigcircle.y,bigcircle.r,0,Math.PI*2,true);
ctxpane.fillStyle = bigcircle.c;
ctxpane.fill();
ctxpane.closePath();

/*画出底部追踪线条*/
ctxpane.beginPath();
ctxpane.lineWidth=4;
ctxpane.strokeStyle = line.c;
ctxpane.arc(line.x, line.y, line.r, line.start, line.end,false); 
ctxpane.stroke(); 
ctxpane.closePath();


function movetest(){
	
	if(ifgameover()&&(!ifcrash()))
	{ 
		clearInterval(timer);
	}
	else
	{
		if(ifcrash())
			{
				randomback();
			}		
ctxpane.clearRect(-200,-200,400,400);	//清屏
	
ctxpane.beginPath();	//大圆
ctxpane.arc(bigcircle.x,bigcircle.y,bigcircle.r,0,Math.PI*2,true);
ctxpane.fillStyle = bigcircle.c;
ctxpane.fill();
ctxpane.closePath();

if(line.direction==gamedirection.clock)   //跟踪线顺时针
{
	line.start=line.start + linespeed;	
	line.end=line.end +linespeed;
	ctxpane.beginPath();
	ctxpane.lineWidth=4;
	ctxpane.strokeStyle = line.c;
	ctxpane.arc(line.x, line.y, line.r, line.start, line.end,false); 
	ctxpane.stroke(); 
	ctxpane.closePath();	
}
if(line.direction==gamedirection.anticlock)									//跟踪逆顺时针
{
	line.start=line.start - linespeed;	
	line.end=line.end -linespeed;
	ctxpane.beginPath();
	ctxpane.lineWidth=4;
	ctxpane.strokeStyle = line.c;
	ctxpane.arc(line.x, line.y, line.r, line.start, line.end,false); 
	ctxpane.stroke(); 
	ctxpane.closePath();		
}
	
dot.x=bigcircle.r*Math.cos(line.start+Math.PI/32)	//跟踪点
dot.y=bigcircle.r*Math.sin(line.start+Math.PI/32)
ctxpane.beginPath();//线上跟踪点
ctxpane.arc(dot.x,dot.y,dot.r,0,Math.PI*2,true);
ctxpane.fillStyle = smallcircle.c;
ctxpane.fill();
ctxpane.closePath();	
/*
dot1.x=bigcircle.r*Math.cos(line.start+Math.PI/32)	//跟踪点1
dot1.y=bigcircle.r*Math.sin(line.start+Math.PI/32)
ctxpane.beginPath();//线上跟踪点
ctxpane.arc(dot1.x,dot.y,dot1.r,0,Math.PI*2,true);
ctxpane.fillStyle = smallcircle.c;
ctxpane.fill();
ctxpane.closePath();	

dot2.x=bigcircle.r*Math.cos(line.start+Math.PI/32)	//跟踪点2
dot2.y=bigcircle.r*Math.sin(line.start+Math.PI/32)
ctxpane.beginPath();//线上跟踪点
ctxpane.arc(dot2.x,dot.y,dot2.r,0,Math.PI*2,true);
ctxpane.fillStyle = smallcircle.c;
ctxpane.fill();
ctxpane.closePath();	
*/
smallcircledirection();//小圆
//ctxpane.save();
ctxpane.beginPath();
ctxpane.arc(smallcircle.x,smallcircle.y,smallcircle.r,0,Math.PI*2,true);
ctxpane.fillStyle = smallcircle.c;
ctxpane.fill();
ctxpane.closePath();
//ctxpane.restore();
	}
}//主函数

 
var timer;
function startgame(){//开始游戏
	smallcircle.direction=gamedirection.xia;
	smallcircle.x=smallcircle.y=0;
	line.start=Math.PI/2-Math.PI/32;
	line.end=Math.PI/2+Math.PI/32;
	line.direction=gamedirection.anticlock;
	
	clearInterval(timer);
	timer=setInterval(movetest,10);	
	}//开始游戏 startgame() 	

</script> 
      </section>
      <footer>
        
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>
